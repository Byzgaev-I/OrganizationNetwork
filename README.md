# Домашнее задание к занятию «Организация сети»

## Цель задания

1. Создать пустую VPC. Выбрать зону.  
2. Публичная подсеть.  
3. Создать в VPC subnet с названием public, сетью 192.168.10.0/24.  
4. Создать в этой подсети NAT-инстанс, присвоив ему адрес 192.168.10.254. В качестве image_id использовать fd80mrhj8fl2oe87o4e1.  
5. Создать в этой публичной подсети виртуалку с публичным IP, подключиться к ней и убедиться, что есть доступ к интернету.  
6. Приватная подсеть.  
7. Создать в VPC subnet с названием private, сетью 192.168.20.0/24.  
8. Создать route table. Добавить статический маршрут, направляющий весь исходящий трафик private сети в NAT-инстанс.  
9. Создать в этой приватной подсети виртуалку с внутренним IP, подключиться к ней через виртуалку, созданную ранее, и убедиться, что есть доступ к интернету.  

## Выполнение задания

### 1. Создание VPC и подсетей

Создал пустую VPC с подсетями:
- Публичная подсеть `public` с CIDR: 192.168.10.0/24
- Приватная подсеть `private` с CIDR: 192.168.20.0/24

Для создания сетевой инфраструктуры использовались следующие ресурсы Terraform:

```hcl
resource "yandex__vpc__network" "network" {
  name = "network"
}

resource "yandex__vpc__subnet" "public" {
  name           = "public"
  zone           = var.zone
  network__id     = yandex__vpc__network.network.id
  v4__cidr__blocks = ["192.168.10.0/24"]
}

resource "yandex__vpc__subnet" "private" {
  name           = "private"
  zone           = var.zone
  network__id     = yandex__vpc__network.network.id
  v4__cidr__blocks = ["192.168.20.0/24"]
  route__table__id = yandex__vpc__route_table.nat-route.id
}
```

### 2. Создание NAT-инстанса

В публичной подсети создан NAT-инстанс с фиксированным IP 192.168.10.254. Настроен для маршрутизации трафика из приватной подсети.

```hcl
resource "yandex_compute_instance" "nat-instance" {
  name        = "nat-instance"
  platform_id = "standard-v1"
  zone        = var.zone

  resources {
    cores  = 2
    memory = 2
  }

  boot_disk {
    initialize_params {
      image_id = var.image_id
    }
  }

  network_interface {
    subnet_id      = yandex_vpc_subnet.public.id
    nat            = true
    ip_address     = "192.168.10.254"
    security_group_ids = [yandex_vpc_security_group.basic.id]
  }

  metadata = {
    ssh-keys  = "ubuntu:${file(var.public_key_path)}"
    user-data = <<-EOF
      #!/bin/bash
      apt-get update
      apt-get install -y iptables-persistent traceroute tcpdump curl
      
      # Настройка IP-форвардинга
      echo 'net.ipv4.ip_forward = 1' | tee /etc/sysctl.d/99-ip-forward.conf
      sysctl -p /etc/sysctl.d/99-ip-forward.conf
      
      # Настройка NAT
      iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
      iptables-save | tee /etc/iptables/rules.v4
      
      # Включение и сохранение правил
      systemctl enable netfilter-persistent
      netfilter-persistent save
    EOF
  }
}
```

### 3. Создание виртуальных машин

Созданы две виртуальные машины:
- Публичная ВМ с внешним IP и доступом в интернет
- Приватная ВМ с доступом в интернет через NAT-инстанс

### 4. Проверка работоспособности

#### 4.1. Подключение к публичной ВМ и проверка доступа в интернет

[Вставьте скриншот подключения к публичной ВМ и результата ping google.com]

#### 4.2. Подключение к приватной ВМ и проверка доступа в интернет

[Вставьте скриншот подключения к приватной ВМ через публичную и результата ping google.com]

#### 4.3. Проверка маршрутизации на приватной ВМ

[Вставьте скриншот вывода команды ip route на приватной ВМ]

## Инфраструктура

```
                    +-----------------+
                    |                 |
                    |  Yandex Cloud   |
                    |                 |
                    +--------+--------+
                             |
                    +--------+--------+
                    |                 |
                    |      VPC        |
                    |                 |
                    +--------+--------+
                             |
           +----------------++-----------------+
           |                                   |
+----------+-----------+        +--------------+-------------+
|                      |        |                            |
| Публичная подсеть    |        | Приватная подсеть          |
| 192.168.10.0/24      |        | 192.168.20.0/24           |
|                      |        |                            |
| +-----------------+  |        | +------------------------+ |
| |                 |  |        | |                        | |
| | NAT-инстанс     +------------> Приватная VM            | |
| | 192.168.10.254  |  |        | | 192.168.20.11          | |
| |                 |  |        | |                        | |
| +-----------------+  |        | +------------------------+ |
|                      |        |                            |
| +-----------------+  |        |                            |
| |                 |  |        |                            |
| | Публичная VM    |  |        |                            |
| |                 |  |        |                            |
| +-----------------+  |        |                            |
|                      |        |                            |
+----------------------+        +----------------------------+
```

## Результат

Задание выполнено полностью. Создана работающая инфраструктура в Yandex Cloud:
- Настроена маршрутизация между подсетями
- Публичная ВМ имеет доступ в интернет
- Приватная ВМ имеет доступ в интернет через NAT-инстанс
- Все соединения работают корректно


=======
# OrganizationNetwork
>>>>>>> f79a0aace00b3c1153e735c9e8e318e790b6d50d
